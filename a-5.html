<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Word Search</title>
<style>
body { font-family: system-ui; text-align:center; background:#f6f7fb; margin:0; }
h1 { margin:12px; }
button { margin:6px; padding:12px 18px; font-size:16px; border-radius:8px; border:none; background:#4f46e5; color:white; }
#game { display:none; }
#grid { display:grid; gap:2px; justify-content:center; margin:12px auto; touch-action:none; }
.cell { width:26px; height:26px; background:white; border:1px solid #ccc; line-height:26px; font-weight:bold; user-select:none; -webkit-user-select:none; }
.cell.selecting { background:#bde3ff; }
.cell.found { background:#8ee28e; }
#words { display:flex; flex-wrap:wrap; justify-content:center; max-width:95%; margin:auto; }
.word { margin:4px 6px; }
.word.done { text-decoration:line-through; color:#999; }
#clear { display:none; font-size:28px; margin-top:20px; }
</style>
</head>
<body>
<h1>Word Search</h1>
<div id="menu">
  <button onclick="start('junior')">Âúã‰∏≠ÊúÉËÄÉ</button>
  <button onclick="start('senior')">È´ò‰∏≠Â≠∏Ê∏¨</button>
  <button onclick="startCustom()">Ëá™Ë®ÇÈ°åÁõÆ</button>
</div>
<div id="game">
  <div id="level"></div>
  <div id="grid"></div>
  <div id="words"></div>
</div>
<div id="clear">üéâ ÂÖ®ÈÉ®ÂÆåÊàêÔºÅ</div>

<script>
document.addEventListener("DOMContentLoaded",()=>{
const gridDiv = document.getElementById("grid");
const wordsDiv = document.getElementById("words");
const levelDiv = document.getElementById("level");
const clearDiv = document.getElementById("clear");

const gridSize = 14;
const wordsPerLevel = 18;
const maxLevel = 30;
let mode, level=0;
let levelWords=[], cells=[], selecting=[], dir=null, isDown=false;

const juniorWords = Array.from({length:600},(_,i)=>"J"+(i+1));
const seniorWords = Array.from({length:600},(_,i)=>"S"+(i+1));

function shuffle(a){ for(let i=a.length-1;i>0;i--){ let j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; } }

window.start = function(m){
  mode = m; level=0;
  document.getElementById("menu").style.display="none";
  document.getElementById("game").style.display="block";
  const pool = mode==="junior"?[...juniorWords]:[...seniorWords];
  shuffle(pool);
  levelWords = [];
  for(let i=0;i<maxLevel;i++){
    levelWords.push(pool.slice(i*wordsPerLevel,(i+1)*wordsPerLevel));
  }
  nextLevel();
};

window.startCustom = function(){
  const input = prompt("Ëº∏ÂÖ•ÂñÆÂ≠óÔºåÁî®ÈÄóËôüÂàÜÈöîÔºö");
  if(!input) return;
  const customWords = input.toUpperCase().split(",").map(w=>w.trim()).filter(w=>w);
  mode="custom"; level=1; levelWords=[customWords];
  document.getElementById("menu").style.display="none";
  document.getElementById("game").style.display="block";
  nextLevel();
};

function nextLevel(){
  found = new Set();
  selecting=[]; dir=null;
  gridDiv.innerHTML=""; wordsDiv.innerHTML=""; clearDiv.style.display="none";
  if(mode!=="custom"){
    level++; levelDiv.textContent=`Á¨¨ ${level} / ${maxLevel} Èóú`;
    buildGrid(levelWords[level-1]);
    renderWords(levelWords[level-1]);
  }else{
    levelDiv.textContent="Ëá™Ë®ÇÈ°åÁõÆÊ®°Âºè";
    buildGrid(levelWords[0]);
    renderWords(levelWords[0]);
  }
}

function buildGrid(wordList){
  gridDiv.style.gridTemplateColumns=`repeat(${gridSize},26px)`;
  cells = Array(gridSize*gridSize).fill("");
  const dirs = [[1,0],[-1,0],[0,1],[0,-1],[1,1],[1,-1],[-1,1],[-1,-1]];

  for(let w of wordList){
    let placed=false;
    for(let t=0;t<300 && !placed;t++){
      let [dx,dy]=dirs[Math.floor(Math.random()*dirs.length)];
      let x=Math.floor(Math.random()*gridSize);
      let y=Math.floor(Math.random()*gridSize);
      let ok=true;
      for(let i=0;i<w.length;i++){
        let nx=x+dx*i, ny=y+dy*i;
        if(nx<0||ny<0||nx>=gridSize||ny>=gridSize){ ok=false; break; }
        let idx=ny*gridSize+nx;
        if(cells[idx] && cells[idx]!==w[i]){ ok=false; break; }
      }
      if(ok){
        for(let i=0;i<w.length;i++){
          let idx=(y+dy*i)*gridSize+(x+dx*i);
          cells[idx]=w[i];
        }
        placed=true;
      }
    }
  }

  const letters="ABCDEFGHIJKLMNOPQRSTUVWXYZ";
  for(let i=0;i<cells.length;i++){
    if(!cells[i]) cells[i]=letters[Math.floor(Math.random()*26)];
    const d=document.createElement("div");
    d.className="cell";
    d.textContent=cells[i];
    d.dataset.i=i;
    gridDiv.appendChild(d);
  }
  bindPointer();
}

function renderWords(wordList){
  wordsDiv.innerHTML="";
  for(let w of wordList){
    const s=document.createElement("span");
    s.textContent=w; s.dataset.word=w; s.className="word";
    wordsDiv.appendChild(s);
  }
}

function bindPointer(){
  gridDiv.onpointerdown = e => {
    if(!e.target.classList.contains("cell")) return;
    isDown = true;
    selecting = [e.target];
    dir = null;
    e.target.classList.add("selecting");
    e.preventDefault();
  };

  document.onpointermove = e => {
    if(!isDown) return;
    const el = document.elementFromPoint(e.clientX,e.clientY);
    if(!el || !el.classList.contains("cell")) return;
    if(selecting.includes(el)) return;
    const a = selecting[0].dataset.i;
    const b = el.dataset.i;
    const ax=a%gridSize, ay=Math.floor(a/gridSize);
    const bx=b%gridSize, by=Math.floor(b/gridSize);
    const dx=Math.sign(bx-ax), dy=Math.sign(by-ay);
    if(!dir){ if(dx===0&&dy===0) return; dir=[dx,dy]; }
    const last=selecting[selecting.length-1].dataset.i;
    const lx=last%gridSize, ly=Math.floor(last/gridSize);
    if(lx+dir[0]===bx && ly+dir[1]===by){
      selecting.push(el);
      el.classList.add("selecting");
    }
  };

  document.onpointerup = () => {
    if(!isDown) return;
    isDown = false;
    checkWord();
    selecting.forEach(c=>c.classList.remove("selecting"));
    selecting=[]; dir=null;
  };
}

function checkWord(){
  let str = selecting.map(c=>c.textContent).join("");
  let rev = str.split("").reverse().join("");
  let wList = mode==="custom"?levelWords[0]:levelWords[level-1];
  let w = wList.find(x=>x===str || x===rev);
  if(w){
    selecting.forEach(c=>c.classList.add("found"));
    let span = Array.from(wordsDiv.children).find(s=>s.dataset.word===w);
    if(span) span.classList.add("done");
    if(mode==="custom"?found.size+1===wList.length:found.size+1===18){
      if(mode!=="custom" && level<maxLevel) setTimeout(nextLevel,800);
      else clearDiv.style.display="block";
    }
    found.add(w);
  }
}

});
</script>
</body>
</html>
