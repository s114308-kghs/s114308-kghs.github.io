<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Word Search</title>

<style>
body {
  font-family: system-ui, -apple-system;
  text-align: center;
  background: #f6f7fb;
  margin: 0;
}

h1 { margin: 12px; }

#menu button {
  margin: 6px;
  padding: 12px 18px;
  font-size: 16px;
}

#game { display: none; }

#grid {
  display: grid;
  gap: 2px;
  justify-content: center;
  margin: 12px auto;
  touch-action: none;
}

.cell {
  width: 26px;
  height: 26px;
  background: white;
  border: 1px solid #ccc;
  line-height: 26px;
  font-weight: bold;
  user-select: none;
  -webkit-user-select: none;
}

.cell.selecting { background: #bde3ff; }
.cell.found { background: #8ee28e; }

#words {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  max-width: 95%;
  margin: auto;
}

.word {
  margin: 4px 6px;
}
.word.done {
  text-decoration: line-through;
  color: #999;
}

#clear {
  display:none;
  font-size: 28px;
  margin-top: 20px;
}
</style>
</head>

<body>
<h1>Word Search</h1>

<div id="menu">
  <button onclick="start('junior')">åœ‹ä¸­æœƒè€ƒ</button>
  <button onclick="start('senior')">é«˜ä¸­å­¸æ¸¬</button>
  <button onclick="startCustom()">è‡ªè¨‚é¡Œç›®</button>
</div>

<div id="game">
  <div id="level"></div>
  <div id="grid"></div>
  <div id="words"></div>
</div>

<div id="clear">ğŸ‰ å…¨éƒ¨å®Œæˆï¼</div>

<script>
document.addEventListener("DOMContentLoaded",()=>{

/* ========= é¡Œåº« ========= */
const juniorWords = Array.from({length:600},(_,i)=>"J"+(i+1));
const seniorWords = Array.from({length:600},(_,i)=>"S"+(i+1));

let mode, level = 0;
let gridSize = 14;
let wordList = [];
let found = new Set();

const grid = document.getElementById("grid");
const wordsDiv = document.getElementById("words");
const levelDiv = document.getElementById("level");

let cells=[], selecting=[], dir=null;

/* ========= å·¥å…· ========= */
function shuffle(a){
  for(let i=a.length-1;i>0;i--){
    let j=Math.floor(Math.random()*(i+1));
    [a[i],a[j]]=[a[j],a[i]];
  }
}

function start(m){
  mode=m; level=0;
  document.getElementById("menu").style.display="none";
  document.getElementById("game").style.display="block";
  nextLevel();
}

function nextLevel(){
  found.clear();
  selecting=[];
  dir=null;
  wordsDiv.innerHTML="";
  grid.innerHTML="";
  document.getElementById("clear").style.display="none";

  level++;
  levelDiv.textContent = `ç¬¬ ${level} é—œ / 30`;

  let source = mode==="junior"?juniorWords:seniorWords;
  shuffle(source);
  wordList = source.slice((level-1)*18, level*18);

  buildGrid();
  renderWords();
}

/* ========= å»ºç›¤ ========= */
function buildGrid(){
  grid.style.gridTemplateColumns = `repeat(${gridSize}, 26px)`;
  cells = Array(gridSize*gridSize).fill("");

  const dirs = [
    [1,0],[-1,0],[0,1],[0,-1],
    [1,1],[1,-1],[-1,1],[-1,-1]
  ];

  for(let w of wordList){
    let placed=false;
    for(let t=0;t<200 && !placed;t++){
      let [dx,dy]=dirs[Math.floor(Math.random()*dirs.length)];
      let x=Math.floor(Math.random()*gridSize);
      let y=Math.floor(Math.random()*gridSize);

      let ok=true;
      for(let i=0;i<w.length;i++){
        let nx=x+dx*i, ny=y+dy*i;
        if(nx<0||ny<0||nx>=gridSize||ny>=gridSize){
          ok=false; break;
        }
        let idx=ny*gridSize+nx;
        if(cells[idx] && cells[idx]!==w[i]){
          ok=false; break;
        }
      }
      if(ok){
        for(let i=0;i<w.length;i++){
          let idx=(y+dy*i)*gridSize+(x+dx*i);
          cells[idx]=w[i];
        }
        placed=true;
      }
    }
  }

  const letters="ABCDEFGHIJKLMNOPQRSTUVWXYZ";
  for(let i=0;i<cells.length;i++){
    if(!cells[i]) cells[i]=letters[Math.floor(Math.random()*26)];
    let d=document.createElement("div");
    d.className="cell";
    d.textContent=cells[i];
    d.dataset.i=i;
    grid.appendChild(d);
  }

  bindPointer();
}

/* ========= æ“ä½œ ========= */
function bindPointer(){
  grid.onpointerdown=e=>{
    if(!e.target.classList.contains("cell"))return;
    grid.setPointerCapture(e.pointerId);
    selecting=[e.target];
    dir=null;
    e.target.classList.add("selecting");
  };

  grid.onpointermove=e=>{
    if(selecting.length===0)return;
    let t=document.elementFromPoint(e.clientX,e.clientY);
    if(!t||!t.classList.contains("cell"))return;
    if(selecting.includes(t))return;

    let a=selecting[0].dataset.i;
    let b=t.dataset.i;
    let ax=a%gridSize, ay=Math.floor(a/gridSize);
    let bx=b%gridSize, by=Math.floor(b/gridSize);
    let dx=Math.sign(bx-ax), dy=Math.sign(by-ay);

    if(!dir){
      if(dx===0&&dy===0)return;
      dir=[dx,dy];
    }

    let last=selecting[selecting.length-1].dataset.i;
    let lx=last%gridSize, ly=Math.floor(last/gridSize);
    if(lx+dir[0]===bx && ly+dir[1]===by){
      selecting.push(t);
      t.classList.add("selecting");
    }
  };

  grid.onpointerup=()=>{
    checkWord();
    selecting.forEach(c=>c.classList.remove("selecting"));
    selecting=[];
    dir=null;
  };
}

/* ========= æª¢æŸ¥ ========= */
function checkWord(){
  let str=selecting.map(c=>c.textContent).join("");
  let rev=str.split("").reverse().join("");
  let w=wordList.find(x=>x===str||x===rev);
  if(w && !found.has(w)){
    found.add(w);
    selecting.forEach(c=>c.classList.add("found"));
    document.querySelector(`[data-word="${w}"]`).classList.add("done");
    if(found.size===18){
      if(level===30){
        document.getElementById("clear").style.display="block";
      }else{
        setTimeout(nextLevel,800);
      }
    }
  }
}

function renderWords(){
  for(let w of wordList){
    let s=document.createElement("span");
    s.textContent=w;
    s.dataset.word=w;
    s.className="word";
    wordsDiv.appendChild(s);
  }
}

/* ========= è‡ªè¨‚ ========= */
window.startCustom=()=>{
  alert("è‡ªè¨‚é¡Œç›®æ¨¡å¼ä¿ç•™ï¼Œæ ¼å­ 14Ã—14ï¼Œå¯è‡ªè¡Œå»¶ä¼¸");
};
});
</script>
</body>
</html>
