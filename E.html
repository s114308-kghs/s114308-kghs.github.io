<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>拉長長麻糬</title>
    <style>
        :root {
            --bg-color: #f9f3e6;
            --mochi-color: #ffffff;
        }

        body {
            background-color: var(--bg-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
            font-family: sans-serif;
            touch-action: none; /* 禁用瀏覽器默認手勢 */
        }

        .instruction {
            color: #8b5a2b;
            margin-bottom: 20px;
            font-size: 1.1rem;
        }

        /* 碗 */
        .bowl-container {
            position: relative;
            width: 250px;
            height: 120px;
            background: #d2b48c;
            border-radius: 0 0 125px 125px;
            border-bottom: 8px solid #bc8f8f;
            display: flex;
            justify-content: center;
            z-index: 10;
        }

        /* 麻糬本體 */
        #mochi {
            position: absolute;
            bottom: 20px;
            width: 160px;
            height: 100px;
            background: var(--mochi-color);
            border-radius: 50% 50% 30% 30%;
            display: flex;
            justify-content: center;
            align-items: center;
            transform-origin: bottom center;
            box-shadow: inset -5px -10px 15px rgba(0,0,0,0.05);
            z-index: 5;
            cursor: grab;
        }

        /* 臉部 */
        .face {
            display: flex;
            gap: 30px;
            pointer-events: none;
        }
        .eye { width: 10px; height: 10px; background: #333; border-radius: 50%; }
        .blush { 
            position: absolute; width: 20px; height: 10px; 
            background: #ffb6c1; border-radius: 50%; bottom: 35px; 
        }

        /* 拉長時產生的文字 */
        .ah-text {
            position: absolute;
            top: -40px;
            color: #8b5a2b;
            font-size: 24px;
            font-weight: bold;
            pointer-events: none;
            opacity: 0;
        }
    </style>
</head>
<body>

    <div class="instruction">按住麻糬向上拉～</div>

    <div style="position: relative; height: 400px; display: flex; align-items: flex-end;">
        <div id="mochi">
            <div id="ah" class="ah-text">阿～～</div>
            <div class="blush" style="left: 25px;"></div>
            <div class="face">
                <div class="eye"></div>
                <div class="eye"></div>
            </div>
            <div class="blush" style="right: 25px;"></div>
        </div>
        <div class="bowl-container"></div>
    </div>

    <script>
        const mochi = document.getElementById('mochi');
        const ahDisplay = document.getElementById('ah');
        let isDragging = false;
        let startY = 0;
        
        // 音訊系統
        let audioCtx;
        let oscillator;
        let gainNode;

        function initAudio() {
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }
        }

        function playSound(freq) {
            if (!oscillator) {
                oscillator = audioCtx.createOscillator();
                gainNode = audioCtx.createGain();
                oscillator.type = 'sine';
                oscillator.connect(gainNode);
                gainNode.connect(audioCtx.destination);
                oscillator.start();
            }
            // 讓聲音聽起來像 "阿" 的共振頻率
            oscillator.frequency.setTargetAtTime(200 + freq, audioCtx.currentTime, 0.1);
            gainNode.gain.setTargetAtTime(0.1, audioCtx.currentTime, 0.1);
        }

        function stopSound() {
            if (gainNode) {
                gainNode.gain.setTargetAtTime(0, audioCtx.currentTime, 0.1);
            }
        }

        function startStretch(e) {
            initAudio();
            isDragging = true;
            startY = e.touches ? e.touches[0].clientY : e.clientY;
            mochi.style.cursor = 'grabbing';
            ahDisplay.style.opacity = '1';
        }

        function doStretch(e) {
            if (!isDragging) return;
            const currentY = e.touches ? e.touches[0].clientY : e.clientY;
            let diff = startY - currentY;
            
            if (diff < 0) diff = 0; // 不往下伸長
            if (diff > 300) diff = 300; // 最大拉伸長度

            // 視覺變形：高度增加，寬度變細
            const scaleY = 1 + (diff / 100);
            const scaleX = 1 - (diff / 500);
            mochi.style.transform = `scale(${scaleX}, ${scaleY})`;
            
            // 更新文字與聲音
            const extraAh = "~".repeat(Math.floor(diff/20));
            ahDisplay.innerText = "阿" + extraAh;
            ahDisplay.style.transform = `scale(${1/scaleX}, ${1/scaleY})`; // 防止文字變形
            
            playSound(diff);
        }

        function endStretch() {
            isDragging = false;
            mochi.style.transform = `scale(1, 1)`;
            mochi.style.cursor = 'grab';
            ahDisplay.style.opacity = '0';
            stopSound();
        }

        // 滑鼠事件
        mochi.addEventListener('mousedown', startStretch);
        window.addEventListener('mousemove', doStretch);
        window.addEventListener('mouseup', endStretch);

        // 觸控事件
        mochi.addEventListener('touchstart', startStretch);
        window.addEventListener('touchmove', doStretch);
        window.addEventListener('touchend', endStretch);

    </script>
</body>
</html>
