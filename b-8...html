<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>éº»ç³¬æ°¸é æœ€ä¸Šå±¤</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  height:100vh;
  background:#f5f0e1;
  font-family:sans-serif;
  overflow:hidden;
}

/* å ´æ™¯ */
#scene{
  position:relative;
  width:100%;
  height:100vh;
  overflow:hidden;
}

/* æœ¨ç¢— */
#usu{
  position:absolute;
  width:300px;
  height:160px;
  background: radial-gradient(circle at 50% 30%, #e6bf86, #b37a3c);
  border-radius:50%/35%;
  bottom:0;
  left:50%;
  transform:translateX(-50%);
  z-index:1;
  box-shadow:
    inset 0 15px 20px rgba(255,255,255,0.3),
    inset 0 -15px 20px rgba(0,0,0,0.25),
    0 -6px 0 #8b5a2b;
}

/* éº»ç³¬ï¼ˆæ°¸é æœ€ä¸Šå±¤ï¼‰ */
#mochi{
  width:80px;
  height:80px;
  background:pink;
  border-radius:50%;
  position:fixed;
  bottom:70px;
  left:50%;
  transform:translate(-50%,0);
  z-index:2147483647;
  display:flex;
  align-items:center;
  justify-content:center;
  touch-action:none;
  user-select:none;
  box-shadow:
    inset -5px -5px 15px rgba(255,255,255,0.5),
    inset 5px 5px 15px rgba(0,0,0,0.15);
  transition:
    width 0.05s,
    height 0.05s,
    border-radius 0.05s,
    opacity 0.3s;
}

/* è±†è±†çœ¼ */
.eye{
  position:absolute;
  width:10px;
  height:10px;
  background:black;
  border-radius:50%;
  top:35%;
  left:25%;
}
.eye.right{ left:55%; }

/* å˜´å·´ */
.mouth{
  position:absolute;
  width:0;
  height:3px;
  background:black;
  border-radius:2px;
  bottom:25%;
  left:50%;
  transform:translateX(-50%);
}

/* çˆ†ç‚¸ç¢ç‰‡ */
.piece{
  position:absolute;
  width:20px;
  height:20px;
  border-radius:50%;
  pointer-events:none;
  z-index:500;
}

/* èª¿è‰²å™¨ï¼ˆä¸æœƒæ“‹éº»ç³¬ï¼‰ */
#colorPicker{
  position:fixed;
  top:10px;
  left:10px;
  width:60px;
  height:40px;
  border:none;
  border-radius:8px;
  z-index:1000;
}

p{
  position:fixed;
  bottom:10px;
  width:100%;
  text-align:center;
  font-size:14px;
  color:#555;
}
</style>
</head>

<body>

<input type="color" id="colorPicker">

<div id="scene">
  <div id="usu"></div>

  <div id="mochi">
    <div class="eye left"></div>
    <div class="eye right"></div>
    <div class="mouth"></div>
  </div>
</div>

<p>åœ¨æœ¨ç¢—è£¡æ—éº»ç³¬ï¼Œæ‹‰åˆ°éå¸¸å¤§æ‰æœƒçˆ†ç‚¸ ğŸ¡</p>

<script>
const mochi = document.getElementById("mochi");
const colorPicker = document.getElementById("colorPicker");
const eyeLeft = mochi.querySelector(".eye.left");
const eyeRight = mochi.querySelector(".eye.right");
const mouth = mochi.querySelector(".mouth");
const scene = document.getElementById("scene");

/* èª¿è‰² */
colorPicker.addEventListener("input", e=>{
  mochi.style.background = e.target.value;
});

/* å°ºå¯¸æ§åˆ¶ */
let size = 80;
const MAX_SIZE = 800;
let stretchInterval = null;

/* çœ¼ç›ç‰©ç†æ™ƒå‹• */
let eyeVX = 0;
let eyeVY = 0;

/* Audio */
const audioCtx = new (window.AudioContext||window.webkitAudioContext)();
let oscillator = null;
let gainNode = null;

function startSoftAh(){
  if(!oscillator){
    oscillator = audioCtx.createOscillator();
    gainNode = audioCtx.createGain();
    oscillator.type="sine";
    oscillator.frequency.value=180;
    gainNode.gain.value=0.12;
    oscillator.connect(gainNode);
    gainNode.connect(audioCtx.destination);
    oscillator.start();
  }
}

function updatePitch(){
  if(oscillator){
    oscillator.frequency.value = 180 + (size-80)*0.3;
    gainNode.gain.value = 0.12 + Math.sin(Date.now()/100)*0.02;
  }
}

function stopSoftAh(){
  if(oscillator){
    oscillator.stop();
    oscillator.disconnect();
    gainNode.disconnect();
    oscillator=null;
    gainNode=null;
  }
}

function playBoom(){
  const osc = audioCtx.createOscillator();
  const gain = audioCtx.createGain();
  osc.type="square";
  osc.frequency.setValueAtTime(60,audioCtx.currentTime);
  osc.frequency.exponentialRampToValueAtTime(20,audioCtx.currentTime+0.3);
  gain.gain.setValueAtTime(1,audioCtx.currentTime);
  gain.gain.exponentialRampToValueAtTime(0.01,audioCtx.currentTime+0.3);
  osc.connect(gain);
  gain.connect(audioCtx.destination);
  osc.start();
  osc.stop(audioCtx.currentTime+0.3);
}

/* çˆ†ç‚¸ */
function explodeMochi(){
  playBoom();
  for(let i=0;i<14;i++){
    const p=document.createElement("div");
    p.className="piece";
    p.style.background=mochi.style.background;
    p.style.left=(mochi.offsetLeft+mochi.offsetWidth/2-10)+"px";
    p.style.bottom="70px";
    scene.appendChild(p);

    const a=Math.random()*Math.PI*2;
    const d=200+Math.random()*300;
    p.animate([
      {transform:"translate(0,0)",opacity:1},
      {transform:`translate(${Math.cos(a)*d}px,${-Math.sin(a)*d}px)`,opacity:0}
    ],{duration:700,easing:"ease-out"});
    setTimeout(()=>p.remove(),700);
  }
  size=80;
}

/* å›å½ˆ */
function rebound(){
  const i=setInterval(()=>{
    size -= (size-80)*0.12;
    mochi.style.width=size+"px";
    mochi.style.height=size+"px";
    mochi.style.borderRadius=50+(size-80)*0.1+"%";
    mouth.style.width=Math.min((size-80)*0.4,20)+"px";

    eyeVX*=0.8;
    eyeVY*=0.8;
    eyeLeft.style.transform=`translate(${eyeVX}px,${eyeVY}px)`;
    eyeRight.style.transform=`translate(${-eyeVX}px,${eyeVY}px)`;

    if(Math.abs(size-80)<0.5){
      mochi.style.width="80px";
      mochi.style.height="80px";
      mochi.style.borderRadius="50%";
      mouth.style.width="0";
      eyeLeft.style.transform="translate(0,0)";
      eyeRight.style.transform="translate(0,0)";
      eyeVX=eyeVY=0;
      clearInterval(i);
    }
  },30);
}

/* æ‹‰ä¼¸ */
function startStretch(){
  audioCtx.resume();
  startSoftAh();
  stretchInterval=setInterval(()=>{
    size+=6;
    if(size>=MAX_SIZE){
      explodeMochi();
      stopStretch();
      return;
    }
    mochi.style.width=size+"px";
    mochi.style.height=size+"px";
    mochi.style.borderRadius=50+(size-80)*0.1+"%";
    mouth.style.width=Math.min((size-80)*0.4,20)+"px";

    const power=Math.min((size-80)/120,6);
    eyeVX+=(Math.random()-0.5)*power;
    eyeVY+=(Math.random()-0.5)*power;
    eyeVX*=0.85;
    eyeVY*=0.85;

    eyeLeft.style.transform=`translate(${eyeVX}px,${eyeVY}px)`;
    eyeRight.style.transform=`translate(${-eyeVX}px,${eyeVY}px)`;

    updatePitch();
  },50);
}

function stopStretch(){
  clearInterval(stretchInterval);
  stopSoftAh();
  rebound();
}

/* äº‹ä»¶ */
mochi.addEventListener("mousedown",e=>{e.preventDefault();startStretch();});
document.addEventListener("mouseup",stopStretch);
mochi.addEventListener("touchstart",e=>{e.preventDefault();startStretch();});
mochi.addEventListener("touchend",stopStretch);
mochi.addEventListener("touchcancel",stopStretch);
</script>

</body>
</html>
