<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>麻糬永遠最上層</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
/* 基礎樣式 */
body{
  margin:0;
  height:100vh;
  overflow:hidden;
  font-family:sans-serif;
  background:
    radial-gradient(circle at 20% 30%, rgba(255,255,255,.6), transparent 40%),
    radial-gradient(circle at 80% 20%, rgba(255,220,230,.5), transparent 45%),
    linear-gradient(to bottom, #fff7e8 0%, #fde2e2 60%, #f5d0a9 100%);
}

#scene{
  position:relative;
  width:100%;
  height:100vh;
  overflow:hidden;
}

/* 漫畫溫馨漂浮雲 */
.cloud{
  position:absolute;
  background:rgba(255,255,255,.8);
  border-radius:50%;
  filter:blur(1px);
  animation: float 40s linear infinite;
}
.cloud::before,
.cloud::after{
  content:"";
  position:absolute;
  background:inherit;
  border-radius:50%;
}
@keyframes float{
  from{ transform:translateX(-200px); }
  to{ transform:translateX(120vw); }
}

/* 地面/桌面 */
#table{
  position:absolute;
  bottom:0;
  width:100%;
  height:120px;
  background:linear-gradient(#e7c8a0,#d2a679);
  z-index:0;
}

/* 木碗 */
#usu{
  position:absolute;
  width:240px;
  height:150px;
  background:#d6a76a;
  border-radius:50%/30%;
  bottom:40px;
  left:50%;
  transform:translateX(-50%);
  z-index:1;
}

/* 麻糬 */
#mochi{
  position:absolute;
  width:80px;
  height:80px;
  background:pink;
  border-radius:50%;
  left:50%;
  bottom:50px;
  transform:translateX(-50%);
  z-index:9999;
  display:flex;
  align-items:center;
  justify-content:center;
  touch-action:none;
  user-select:none;
  box-shadow:inset -5px -5px 15px rgba(255,255,255,.5),
             inset 5px 5px 15px rgba(0,0,0,.1);
}

/* 豆豆眼與嘴 */
.eye{
  position:absolute;
  background:black;
  border-radius:50%;
  top:35%;
  transition:all .05s;
}
.eye.left{ left:26%; width:10px; height:10px; }
.eye.right{ left:56%; width:10px; height:10px; }

.mouth{
  position:absolute;
  height:3px;
  background:black;
  border-radius:2px;
  bottom:25%;
  width:0;
}

/* 碎片 */
.piece{
  position:absolute;
  width:20px;
  height:20px;
  border-radius:50%;
  pointer-events:none;
}

/* 調色器 */
#colorPicker{
  position:fixed;
  top:10px;
  left:10px;
  z-index:10000;
}
</style>
</head>
<body>

<input type="color" id="colorPicker">
<div id="scene">
  <!-- 漫畫雲 -->
  <div class="cloud" style="width:120px;height:50px;top:15%;left:-150px;"></div>
  <div class="cloud" style="width:160px;height:60px;top:30%;left:-300px;animation-duration:55s;"></div>
  <div class="cloud" style="width:90px;height:40px;top:22%;left:-200px;animation-duration:45s;"></div>
  
  <!-- 地面 -->
  <div id="table"></div>

  <!-- 木碗 -->
  <div id="usu"></div>

  <!-- 麻糬 -->
  <div id="mochi">
    <div class="eye left"></div>
    <div class="eye right"></div>
    <div class="mouth"></div>
  </div>
</div>

<script>
const mochi=document.getElementById("mochi");
const eyeL=mochi.querySelector(".eye.left");
const eyeR=mochi.querySelector(".eye.right");
const mouth=mochi.querySelector(".mouth");
const picker=document.getElementById("colorPicker");
const scene=document.getElementById("scene");

let size=80;
const MAX=800;
let timer=null;

/* 音效 */
const ctx=new (window.AudioContext||webkitAudioContext)();
let osc,gain;

function startSound(){
  if(osc)return;
  osc=ctx.createOscillator();
  gain=ctx.createGain();
  osc.type="sine";
  osc.frequency.value=180;
  gain.gain.value=0.12;
  osc.connect(gain);
  gain.connect(ctx.destination);
  osc.start();
}
function updateSound(){
  if(osc) osc.frequency.value=180+(size-80)*0.3;
}
function stopSound(){
  if(osc){
    osc.stop();
    osc.disconnect();
    gain.disconnect();
    osc=null;
  }
}

picker.oninput=e=>mochi.style.background=e.target.value;

function explode(){
  const r=mochi.getBoundingClientRect();
  for(let i=0;i<14;i++){
    const p=document.createElement("div");
    p.className="piece";
    p.style.background=mochi.style.background;
    p.style.left=r.left+r.width/2+"px";
    p.style.top=r.top+r.height/2+"px";
    scene.appendChild(p);
    const a=Math.random()*2*Math.PI;
    const d=80+Math.random()*120;
    p.animate([
      {transform:"translate(0,0)",opacity:1},
      {transform:`translate(${Math.cos(a)*d}px,${Math.sin(a)*d}px)`,opacity:0}
    ],{duration:600,easing:"ease-out"});
    setTimeout(()=>p.remove(),600);
  }
  size=80;
  mochi.style.width=mochi.style.height="80px";
  mochi.style.borderRadius="50%";
}

function stretch(){
  ctx.resume();
  startSound();
  timer=setInterval(()=>{
    size+=6;
    if(size>=MAX){
      explode();
      stop();
      return;
    }
    mochi.style.width=mochi.style.height=size+"px";
    mochi.style.borderRadius=50+(size-80)*.1+"%";

    const eyeSize=10+(size-80)*.03;
    const wob=Math.sin(Date.now()/60)*3;
    eyeL.style.width=eyeL.style.height=eyeSize+"px";
    eyeR.style.width=eyeR.style.height=eyeSize+"px";
    eyeL.style.transform=`translate(${wob}px,0)`;
    eyeR.style.transform=`translate(${wob}px,0)`;

    mouth.style.width=Math.min((size-80)*.4,24)+"px";
    updateSound();
  },50);
}

function stop(){
  clearInterval(timer);
  stopSound();
}

mochi.onmousedown=e=>{e.preventDefault();stretch();}
document.onmouseup=stop;
mochi.ontouchstart=e=>{e.preventDefault();stretch();}
mochi.ontouchend=stop;
</script>

</body>
</html>
