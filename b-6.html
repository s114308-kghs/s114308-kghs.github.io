<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>È∫ªÁ≥¨Ê∞∏ÈÅ†ÊúÄ‰∏äÂ±§</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin: 0;
  height: 100vh;
  overflow: hidden;
  font-family: sans-serif;
  background: linear-gradient(
    to bottom,
    #fff0f6 0%,
    #ffe3ec 40%,
    #f5f0e1 100%
  );
}

#scene {
  position: relative;
  width: 100%;
  height: 100vh;
  overflow: hidden;
}

/* Êó•ÂÖâÊöà */
#scene::before {
  content: "";
  position: absolute;
  top: -200px;
  left: 50%;
  transform: translateX(-50%);
  width: 600px;
  height: 600px;
  background: radial-gradient(
    circle,
    rgba(255,255,255,0.8) 0%,
    rgba(255,255,255,0.4) 30%,
    rgba(255,255,255,0) 65%
  );
  z-index: 0;
  pointer-events: none;
}

/* Ëáº */
#usu {
  position: absolute;
  width: 220px;
  height: 140px;
  bottom: 0;
  left: 50%;
  transform: translateX(-50%);
  background: linear-gradient(to bottom, #e6b87e, #cfa063);
  border-radius: 50% / 30%;
  box-shadow: inset 0 6px 0 rgba(255,255,255,0.3);
  z-index: 1;
}

/* È∫ªÁ≥¨ */
#mochi {
  width: 80px;
  height: 80px;
  background: pink;
  border-radius: 50%;
  position: fixed;
  bottom: 50px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 9999;
  display: flex;
  align-items: center;
  justify-content: center;
  touch-action: none;
  user-select: none;
  box-shadow: inset -5px -5px 15px rgba(255,255,255,0.5),
              inset 5px 5px 15px rgba(0,0,0,0.1);
  transition: width 0.05s, height 0.05s, border-radius 0.05s;
}

.eye {
  position: absolute;
  width: 10px;
  height: 10px;
  background: black;
  border-radius: 50%;
  top: 35%;
  left: 25%;
}

.eye.right { left: 55%; }

.mouth {
  position: absolute;
  width: 0;
  height: 3px;
  background: black;
  border-radius: 2px;
  bottom: 25%;
  left: 50%;
  transform: translateX(-50%);
}

/* ÁàÜÁÇ∏Á¢éÁâá */
.piece {
  position: absolute;
  width: 20px;
  height: 20px;
  background: pink;
  border-radius: 50%;
  pointer-events: none;
  z-index: 500;
}

/* Ê´ªËä±Ëä±Áì£ */
.petal {
  position: absolute;
  width: 14px;
  height: 10px;
  background: radial-gradient(
    ellipse at top left,
    #ffe6ef 0%,
    #ffb7cf 70%
  );
  border-radius: 60% 40% 60% 40%;
  opacity: 0.8;
  pointer-events: none;
  animation: fall linear infinite;
  z-index: 0;
}

@keyframes fall {
  0% {
    transform: translate(0,0) rotate(0deg);
    opacity: 0;
  }
  10% { opacity: 1; }
  100% {
    transform: translate(-80px,120vh) rotate(360deg);
    opacity: 0;
  }
}

/* Ë™øËâ≤Âô® */
#colorPicker {
  position: fixed;
  top: 10px;
  left: 10px;
  width: 60px;
  height: 40px;
  border: none;
  border-radius: 8px;
  z-index: 10000;
}

p {
  text-align: center;
  color: #555;
  font-size: 14px;
  margin-top: 10px;
}
</style>
</head>

<body>

<input type="color" id="colorPicker">

<div id="scene">
  <div id="usu"></div>

  <div id="mochi">
    <div class="eye left"></div>
    <div class="eye right"></div>
    <div class="mouth"></div>
  </div>
</div>

<p>ÊãâÈ∫ªÁ≥¨Âà∞ÈùûÂ∏∏Â§ßÊâçÊúÉÁàÜÁÇ∏ üå∏</p>

<script>
const mochi = document.getElementById("mochi");
const scene = document.getElementById("scene");
const colorPicker = document.getElementById("colorPicker");
const eyeLeft = mochi.querySelector(".eye.left");
const eyeRight = mochi.querySelector(".eye.right");
const mouth = mochi.querySelector(".mouth");

colorPicker.addEventListener("input", e => {
  mochi.style.background = e.target.value;
});

let size = 80;
const MAX_SIZE = 800;
let stretchInterval = null;

/* Èü≥Êïà */
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
let oscillator = null;

function startSound() {
  if (!oscillator) {
    oscillator = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    oscillator.type = "sine";
    oscillator.frequency.value = 180;
    gain.gain.value = 0.12;
    oscillator.connect(gain);
    gain.connect(audioCtx.destination);
    oscillator.start();
    oscillator.gainNode = gain;
  }
}

function updateSound() {
  if (oscillator) {
    oscillator.frequency.value = 180 + (size - 80) * 0.3;
  }
}

function stopSound() {
  if (oscillator) {
    oscillator.stop();
    oscillator.disconnect();
    oscillator.gainNode.disconnect();
    oscillator = null;
  }
}

function explode() {
  for (let i = 0; i < 12; i++) {
    const p = document.createElement("div");
    p.className = "piece";
    p.style.background = mochi.style.background;
    const rect = mochi.getBoundingClientRect();
    p.style.left = rect.left + rect.width / 2 + "px";
    p.style.top = rect.top + rect.height / 2 + "px";
    scene.appendChild(p);

    const angle = Math.random() * Math.PI * 2;
    const dist = 80 + Math.random() * 120;
    p.animate([
      { transform: "translate(0,0)", opacity: 1 },
      { transform: `translate(${Math.cos(angle)*dist}px,${Math.sin(angle)*dist}px)`, opacity: 0 }
    ], { duration: 600 });

    setTimeout(() => p.remove(), 600);
  }
  size = 80;
}

function rebound() {
  const i = setInterval(() => {
    size += (80 - size) * 0.15;
    mochi.style.width = size + "px";
    mochi.style.height = size + "px";
    mouth.style.width = Math.max(0, (size - 80) * 0.4) + "px";
    if (Math.abs(size - 80) < 0.5) {
      size = 80;
      mochi.style.width = "80px";
      mochi.style.height = "80px";
      mouth.style.width = "0px";
      clearInterval(i);
    }
  }, 30);
}

function startStretch() {
  audioCtx.resume();
  startSound();
  stretchInterval = setInterval(() => {
    size += 6;
    if (size >= MAX_SIZE) {
      explode();
      stopStretch();
      return;
    }
    mochi.style.width = size + "px";
    mochi.style.height = size + "px";
    mouth.style.width = Math.min((size - 80) * 0.4, 20) + "px";
    updateSound();
  }, 50);
}

function stopStretch() {
  clearInterval(stretchInterval);
  stopSound();
  rebound();
}

mochi.addEventListener("mousedown", e => { e.preventDefault(); startStretch(); });
document.addEventListener("mouseup", stopStretch);
mochi.addEventListener("touchstart", e => { e.preventDefault(); startStretch(); });
mochi.addEventListener("touchend", stopStretch);

/* Ê´ªËä±ÁîüÊàê */
function createPetal() {
  const petal = document.createElement("div");
  petal.className = "petal";
  petal.style.left = Math.random() * 100 + "vw";
  petal.style.animationDuration = 10 + Math.random() * 8 + "s";
  petal.style.transform = `scale(${0.6 + Math.random() * 0.6})`;
  scene.appendChild(petal);
  setTimeout(() => petal.remove(), 18000);
}

for (let i = 0; i < 20; i++) createPetal();
setInterval(createPetal, 1200);
</script>

</body>
</html>
